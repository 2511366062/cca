---
title: "Mye"
author: "lixiaokang"
date: "2025-04-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## 1. èšç±»åˆ†æ
```{r}
library(harmony)

obj_cafs = subset(sce.all, celltype == "CAFs")
obj_cafs = obj_cafs %>% 
    NormalizeData() %>%  
    FindVariableFeatures() %>%  
    ScaleData(features = rownames(.)) %>%  
    RunPCA(pc.genes = VariableFeatures(.))  %>%
    RunHarmony("orig.ident") %>%
    FindNeighbors(dims = 1:15, reduction = "harmony") %>% 
    FindClusters(resolution = 0.8) %>% 
    RunUMAP(dims = 1:15,reduction = "harmony") #%>% 

#0 - 13ä¸ªç°‡

```


## æ³¨é‡Š
```{r}

markers <- FindAllMarkers(obj_cafs, #only.pos = TRUE, åªè¿”å›æ­£
                               min.pct = 0.25, #è¿‡æ»¤æ¡ä»¶ï¼Œè‡³å°‘è¦åœ¨æŸä¸ªğŸˆ¶25%ç»†èƒè¡¨è¾¾
                               #logfc.threshold = 0.25#logFC>0.25
                               )
  

    test_markers = markers[markers$avg_log2FC > 0.4 & 
                             markers$pct.1 > 0.25  & 
                             markers$cluster %in% c(6,7,11)&
                             markers$p_val_adj < 0.01,c("avg_log2FC","cluster", "p_val_adj", "gene")]
library(data.table)
fwrite(test_markers, "exporCAFs/test_markers_testTcafs(6-66666666).csv")

writeLines(paste0(as.character(0:13),","))

obj_cafs= zhushi(object = obj_cafs,file = "import/zhushi/CAFs_zhushi.txt")




genes = read.table("import/marker/CAFs_markers.csv", header=F, sep=",",comment.char = "", check.names =FALSE)

#æ³¨é‡Šçš„æ°”æ³¡å›¾
p = jjDotPlot(object = obj_cafs,
          gene  = genes$V2,
          anno = T,
          plot.margin = c(3,1,1,1),
          point.geom = T,
          tile.geom = F,
          x.text.angle = 90,#xå­—ä½“æ—‹è½¬
          id = "seurat_clusters",#çºµåæ ‡
          dot.col = c("#edf8b1","#2c7fb8")
          )
p


# åˆ†ç°‡å›¾
p0 = clusterCornerAxes(object = obj_cafs,
                  reduction = 'umap',
                  noSplit = T,#ä¸ç»„
                  clusterCol = 'seurat_clusters',
                  cellLabel = T,#è®¾ç½®äº†åˆ™åœ¨å›¾ä¸­æ ‡å‡ºæ¥
                  cellLabelSize = 10,#ç»†èƒåçš„å¤§å°
                  pSize = 0.1,
                  arrowType='open',#åˆ†å¼€çš„ç®­å¤´
                  show.legend = T, #åˆ é™¤å›¾ä¾‹
                  
                  ) + scale_color_manual(values = palette)






#æ³¨é‡Šå›¾
p1 = clusterCornerAxes(object = obj_cafs,
                  reduction = 'umap',
                  noSplit = T,#ä¸ç»„
                  clusterCol = 'celltype',
                  cellLabel = T,#è®¾ç½®äº†åˆ™åœ¨å›¾ä¸­æ ‡å‡ºæ¥
                  cellLabelSize = 5,#ç»†èƒåçš„å¤§å°
                  pSize = 0.1,
                  arrowType='open',#åˆ†å¼€çš„ç®­å¤´
                  show.legend = T, #åˆ é™¤å›¾ä¾‹
                  
                  ) +
scale_color_manual(values = palette)
p1

p0 + p1

pdf(file = "plot/CAFs/UMAP_.pdf",width = 15,height = 10)
p0 + p1
dev.off





```

## ç”»å›¾ï¼šUMAPå¯¹æ¯” ç»†èƒæ•°é‡æ¡å½¢å›¾ æ¯”ä¾‹å›¾
```{r}
umap = yaqun_paint_umap(obj = obj_cafs)
shuliangtu = yaqun_paint_tiaoxingtu(obj = obj_cafs,"turned","normal")
bili = yaqun_paint_bili(obj = obj_cafs)

pdf(file = "plot/CAFs/è½¬ç§»ç»„å’Œéè½¬ç§»ç»„çš„UMAP.pdf",width = 15,height = 10)
umap$umap_comp
dev.off

pdf(file = "plot/CAFs/6ä¸ªæ ·æœ¬çš„UMAP.pdf",width = 15,height = 10)
umap$umap_sample
dev.off


pdf(file = "plot/CAFs/æ‰€æœ‰ç»†èƒä¸ªæ•°ç»Ÿè®¡.pdf",width = 12,height = 9)
shuliangtu$all
dev.off

pdf(file = "plot/CAFs/è½¬ç§»ç»„ä¸ªæ•°ç»Ÿè®¡.pdf",width = 12,height = 9)
shuliangtu$yes
dev.off

pdf(file = "plot/CAFs/éè½¬ç§»ä¸ªæ•°ç»Ÿè®¡.pdf",width = 12,height = 9)
shuliangtu$no
dev.off

pdf(file = "plot/CAFs/turned_norturnedç»†èƒæ¯”ä¾‹æ¡å½¢å›¾.pdf",width = 12,height = 9)
bili$two
dev.off

pdf(file = "plot/CAFs/6æ ·æœ¬ç»†èƒæ¯”ä¾‹æ¡å½¢å›¾.pdf",width = 12,height = 9)
bili$all
dev.off


```
## markeråŸºå› æ°”æ³¡å›¾å’Œçƒ­å›¾
```{r}
list = heatmap_paopaotu(obj = obj_cafs,file = "import/marker/CAFs_markers.csv")

pdf(file = "plot/CAFs/markeråŸºå› æ°”æ³¡å›¾.pdf",width = 15,height = 10)
list$paopao
dev.off

pdf(file = "plot/CAFs/markeråŸºå› çƒ­å›¾.pdf",width = 15,height = 10)
list$heatmap
dev.off

```

## å·®å¼‚è¡¨è¾¾åˆ†æ
```{r}

#æ‰€æœ‰çš„
t_diff = diff_we(object = obj_cafs,
                   ident_1 = "turned",
                   ident_2 = "normal",
                   category = "category",
                  log2FC = 0.4)
 genes = rownames(t_diff)[t_diff$tag %in% c("up","down")]
 
 genesUp = get_upgene(object = t_diff)
 genesdown = rownames(t_diff)[t_diff$tag %in% c("down")]
 
 

 
 do_genesUp =c(
  "FN1",       # çº¤ç»´è¿æ¥è›‹ç™½ï¼Œä¿ƒè¿›EMTå’Œè¿ç§»
  "LOXL2",     # èƒ¶åŸäº¤è”é…¶ï¼Œå¢å¼ºåŸºè´¨ç¡¬åº¦
  "TWIST1",    # EMTæ ¸å¿ƒè½¬å½•å› å­
  "ANGPT2",    # è¡€ç®¡ç”Ÿæˆè°ƒæ§å› å­
  "PTK2",      # FAKï¼Œè°ƒæ§ç»†èƒè¿ç§»
  "POSTN",     # åŸºè´¨é‡å¡‘è›‹ç™½ï¼Œæ”¯æŒè½¬ç§»å‰å¾®ç¯å¢ƒ
  "COL4A1",    # åŸºåº•è†œæˆåˆ†ï¼Œä¿ƒè¿›ä¾µè¢­
  "COL4A2",    # åŸºåº•è†œæˆåˆ†ï¼ŒååŒCOL4A1
  "TGFBI",     # TGF-Î²è¯±å¯¼çš„EMTç›¸å…³è›‹ç™½
  "VASP",      # ç»†èƒéª¨æ¶è°ƒæ§ï¼Œå¢å¼ºè¿ç§»
  "MCAM",      # CD146ï¼Œè¡€ç®¡ç”Ÿæˆå’Œè·¨å†…çš®è¿ç§»
  "FLT1",      # VEGFR1ï¼Œè¡€ç®¡ç”Ÿæˆ
  "ITGA1",     # æ•´åˆç´ Î±1ï¼Œä»‹å¯¼ECMç›¸äº’ä½œç”¨
  "ITGA5",     # æ•´åˆç´ Î±5ï¼Œä¿ƒè¿›ä¾µè¢­
  "RHOQ",      # Rho GTPé…¶ï¼Œè°ƒæ§ç»†èƒææ€§
  "HIF1A",     # ç¼ºæ°§è¯±å¯¼å› å­ï¼Œæ¿€æ´»è½¬ç§»é€šè·¯
  "PFKP",      # ç³–é…µè§£é…¶ï¼Œæ”¯æŒè½¬ç§»èƒ½é‡éœ€æ±‚
  "GBP1",      # å…ç–«å¾®ç¯å¢ƒè°ƒæ§
  "CXCL14",     # è¶‹åŒ–å› å­ï¼Œæ‹›å‹Ÿå…ç–«æŠ‘åˆ¶ç»†èƒ
  "SPP1",
  "COL4A1",
  "COL4A2",
  "ITGA1",
  "GZMB"
  
)
 
 do_genesDown = c(
  "DCN",        # Decorinï¼ŒæŠ‘åˆ¶TGF-Î²ä¿¡å·å’ŒEMTï¼ˆPMID: 25693835ï¼‰
  "CD9",        # è·¨è†œè›‹ç™½ï¼ŒæŠ‘åˆ¶ç»†èƒè¿ç§»å’Œä¾µè¢­ï¼ˆPMID: 28445434ï¼‰
  "CLU",        # ç°‡é›†è›‹ç™½ï¼ŒæŠ‘åˆ¶EMTå’ŒåŸºè´¨é™è§£ï¼ˆPMID: 28783737ï¼‰
  "SPINT2",     # ä¸æ°¨é…¸è›‹ç™½é…¶æŠ‘åˆ¶å‰‚ï¼ŒæŠ‘åˆ¶HGF/METé€šè·¯ï¼ˆPMID: 31235721ï¼‰
  "TGFB3",      # TGF-Î²3ï¼Œè°ƒæ§ECMç¨³æ€å’ŒæŠ‘åˆ¶ä¾µè¢­ï¼ˆPMID: 28903465ï¼‰
  "CLDN4",      # Claudin-4ï¼Œç»´æŒç»†èƒé—´ç²˜é™„ï¼ŒæŠ‘åˆ¶EMTï¼ˆPMID: 30250309ï¼‰
  "DUSP1",      # åŒç‰¹å¼‚æ€§ç£·é…¸é…¶1ï¼ŒæŠ‘åˆ¶MAPKä¿¡å·å’Œè½¬ç§»ï¼ˆPMID: 31534453ï¼‰
  "SFRP1",      # Wntä¿¡å·æ‹®æŠ—å‰‚ï¼ŒæŠ‘åˆ¶Wnt/Î²-cateniné€šè·¯ï¼ˆPMID: 29512381ï¼‰
  "SFRP2",      # åŒä¸Šï¼Œè°ƒæ§Wntä¿¡å·å’ŒEMTï¼ˆPMID: 28545121ï¼‰
  "RARRES2",    # è§†é»„é…¸å—ä½“åº”ç­”è›‹ç™½ï¼ŒæŠ‘åˆ¶è¡€ç®¡ç”Ÿæˆï¼ˆPMID: 27108394ï¼‰
  "PRELP",      # è°ƒæ§ECMæˆåˆ†ï¼ŒæŠ‘åˆ¶åŸºè´¨é‡å¡‘ï¼ˆPMID: 30700910ï¼‰
  "SDC1",       # Syndecan-1ï¼ŒæŠ‘åˆ¶ä¾µè¢­å’Œè½¬ç§»ï¼ˆPMID: 31937921ï¼‰
  "HTRA1",      # ä¸æ°¨é…¸è›‹ç™½é…¶ï¼ŒæŠ‘åˆ¶MMPæ´»æ€§ï¼ˆPMID: 31819108ï¼‰
  "TIMP3",      # é‡‘å±è›‹ç™½é…¶æŠ‘åˆ¶å‰‚ï¼ˆè™½æœªåœ¨åˆ—è¡¨ï¼Œä½†ç›¸å…³åŸºå› éœ€å…³æ³¨ï¼‰
  "CD24"        # å…ç–«æ£€æŸ¥ç‚¹è°ƒæ§ï¼ŒæŠ‘åˆ¶è½¬ç§»ï¼ˆPMID: 31666796ï¼‰
)
 
 
 ls_hs = getMyHSplot(object = t_diff,genes = c(do_genesDown,do_genesUp))
 
 pdf("plot/CAFs/ä¿ƒè½¬ç§»é‡ç‚¹åŸºå› çš„ç«å±±å›¾.pdf",width = 10,height = 8)
ls_hs$p1
dev.off



do_genesUp = c(  "GBP1",      # å…ç–«å¾®ç¯å¢ƒè°ƒæ§
  "CXCL14",     # è¶‹åŒ–å› å­ï¼Œæ‹›å‹Ÿå…ç–«æŠ‘åˆ¶ç»†èƒ
  "SPP1",
  "COL4A1",
  "COL4A2",
  "ITGA1")
#umapå›¾å±•ç¤ºåŸºå› è¡¨è¾¾æƒ…å†µ
p = featureCornerAxes(object = obj_cafs,reduction = 'umap',
                  groupFacet ="category",
                  relLength = 0.5,
                  relDist = 0.2,
                  axes = 'one',
                  features = do_genesUp,
                  minExp = 0,maxExp = 4,
                  pSize = 0.1,
                  low = "#edf8b1",
                  high = "#2c7fb8"
                  )

  pdf("plot/CAFs/ä¿ƒè½¬ç§»ä¸Šè°ƒåŸºå› è¡¨è¾¾æƒ…å†µ.pdf",width = 10,height = 20)
p
dev.off



p = featureCornerAxes(object = obj_cafs,reduction = 'umap',
                  groupFacet ="category",
                  relLength = 0.5,
                  relDist = 0.2,
                  axes = 'one',
                  features = do_genesDown,
                  minExp = 0,maxExp = 4,
                  pSize = 0.1,
                  low = "#edf8b1",
                  high = "#2c7fb8"
                  )

pdf("plot/CAFs/ä¿ƒè½¬ç§»ä¸‹è°ƒåŸºå› è¡¨è¾¾æƒ…å†µ.pdf",width = 10,height = 20)
p
dev.off



#çƒ­å›¾å±•ç¤º
DoHeatmap(obj_cafs, features = do_genesUp) + NoLegend()+
  scale_fill_gradientn(colors = c("#2fa1dd", "white", "#f87669"))
```


#å¯Œé›†åˆ†æ
```{r}
ls = do_GO_KEGG(object = t_diff,filego = "plot/CAFs/trep_go.csv",filekegg = "plot/CAFs/trep_kegg.csv",tag = "up")
pdf("plot/CAFs/goåˆ†ææ°”æ³¡å›¾.pdf",width = 10,height = 15)
ls$go_p2
dev.off

pdf("plot/CAFs/keggåˆ†ææ°”æ³¡å›¾.pdf",width = 10,height = 15)
ls$kegg_p2
dev.off

```


## å°æç´å›¾
```{r}

 pdudu = gene_to_gene(obj = obj_cafs,
            celltypes = "t_C1_KLRB1+",
            genes = "PKM",
            category = "category")
compare_OneGene(object = subset(obj_cafs,celltype == "t_C1_KLRB1+"),
                     gene = "PKM",
                     category = "category",
                     cellname = "t_C1_KLRB1+")
p1 = compare_OneGene(object = subset(obj_cafs,celltype == "myCAFs"),gene = "GBP1",category = "category",cellname = "GBP1")

p2 = compare_OneGene(object = subset(obj_cafs,celltype == "myCAFs"),gene = "COL4A1",category = "category",cellname = "COL4A1")
p2

p3 = compare_OneGene(object = subset(obj_cafs,celltype == "myCAFs"),gene = "COL4A2",category = "category",cellname = "COL4A2")
p3

p4 = compare_OneGene(object = subset(obj_cafs,celltype == "myCAFs"),gene = "ITGA1",category = "category",cellname = "ITGA1")
p4





pdf(file = "plot/CAFs/myCAFsä¸€äº›ä¿ƒè½¬ç§»ä¸Šè°ƒåŸºå› .pdf",width = 12,height = 10)
p1 + p2 + p3+p4
dev.off



```


#GSEAå¯Œé›†åˆ†æ
```{r}
all_gene = rownames(t_diff)
all_ENTREZID = bitr(all_gene, 
                      fromType = "SYMBOL", 
                      toType = "ENTREZID", 
                      OrgDb = org.Hs.eg.db)
t_diff_log2FC = t_diff[which(rownames(t_diff) %in% all_ENTREZID$SYMBOL),]

logFC_dat = data.frame(SYMBOL = rownames(t_diff_log2FC),log2FC = t_diff_log2FC$avg_log2FC)

finally_dat = merge(logFC_dat,all_ENTREZID,by = "SYMBOL")
finally_vector = as.vector(finally_dat$log2FC)
names(finally_vector) = as.vector(finally_dat$ENTREZID)
finally_vector = sort(finally_vector,decreasing = T)

GSEA_KEGG <- gseKEGG(finally_vector, organism = 'hsa', pvalueCutoff = 0.05,pAdjustMethod = "BH")

#ä½¿ç”¨GOæ•°æ®åº“å¯Œé›†åˆ°äº†
GSEA_GO <- gseGO(
  geneList = finally_vector,
  OrgDb = org.Hs.eg.db,
  ont = "BP",  # Biological Process
  pvalueCutoff = 0.05
)

# ä½¿ç”¨KEGGæ•°æ®åº“é‡æ–°è¿è¡ŒgseKEGG,è¿™é‡Œæ²¡æœ‰å¯Œé›†åˆ°
GSEA_KEGG <- gseKEGG(
  geneList = finally_vector,
  organism = "hsa",
  pvalueCutoff = 0.08 #0.25
)


library(clusterProfiler)
library(org.Hs.eg.db)
#devtools::install_github("junjunlab/GseaVis")
library("GseaVis")

 p = dotplotGsea(data=GSEA_KEGG,topn=10,add.seg = T)
pdf(file = "plot/CAFs/CAFsç»†èƒçš„GSEAå¯Œé›†åˆ†æTOP10.pdf",width = 10,height = 10)
 p
dev.off



key_metastasis_pathways <- c(
  "MAPK signaling pathway",              # è°ƒæ§ç»†èƒè¿ç§»ã€ä¾µè¢­å’ŒEMT
  "NF-kappa B signaling pathway",        # é©±åŠ¨ç‚ç—‡ååº”å’ŒæŠ—å‡‹äº¡ï¼Œä¿ƒè¿›è½¬ç§»å¾®ç¯å¢ƒ
  "HIF-1 signaling pathway",             # ç¼ºæ°§é€‚åº”ï¼Œå¢å¼ºè¡€ç®¡ç”Ÿæˆå’Œç»†èƒä¾µè¢­
  "TNF signaling pathway",               # æ¿€æ´»ä¿ƒç‚å› å­ï¼Œä¿ƒè¿›åŸºè´¨é‡å¡‘å’Œå…ç–«é€ƒé€¸
  "IL-17 signaling pathway",             # ä»‹å¯¼æ…¢æ€§ç‚ç—‡ï¼ŒåŠ é€Ÿè‚¿ç˜¤ç»†èƒæ‰©æ•£
  "Transcriptional misregulation in cancer", # è‡´ç™Œè½¬å½•å› å­ï¼ˆå¦‚MYCã€STAT3ï¼‰é©±åŠ¨è½¬ç§»åŸºå› è¡¨è¾¾
  
  "Viral carcinogenesis"                 # ç—…æ¯’è›‹ç™½ï¼ˆå¦‚HPV E6/E7ï¼‰ç ´åæŠ‘ç™ŒåŸºå› ï¼Œé—´æ¥ä¿ƒè¿›è½¬ç§»
)

key_metastasis_pathways = GSEA_KEGG@result$Description

terms = GSEA_KEGG@result[GSEA_KEGG@result$Description %in% key_metastasis_pathways,]$ID

gseaNb(object=GSEA_KEGG,
geneSetID='hsa05134',
newGsea=T)





p = gseaNb(object=GSEA_KEGG,
geneSetID=terms,
subPlot=2,
termWidth=35,
curveCol = palette[1:9],
legend.position=c(0.8,0.8))


pdf(file = "plot/CAFs/CAFsç»†èƒçš„GSEAå¯Œé›†åˆ†æ:çš„é€šè·¯.pdf",width = 15,height = 12)
 p
dev.off
```






## å±•ç¤ºæ¯ä¸ªç»†èƒç¾¤çš„topåŸºå› 
```{r}

Mye_allmarkers <- FindAllMarkers(obj_cafs, #only.pos = TRUE, åªè¿”å›æ­£
                               min.pct = 0.4, #è¿‡æ»¤æ¡ä»¶ï¼Œè‡³å°‘è¦åœ¨æŸä¸ªğŸˆ¶25%ç»†èƒè¡¨è¾¾
                               #logfc.threshold = 0.25#logFC>0.25
                               )
p = markerVolcano(markers = Mye_allmarkers,
              topn = 5,
              labelCol = palette)

pdf(file = "plot/CAFs/top5åŸºå› .pdf",width = 15,height = 10)
p
dev.off
```


## æ‹Ÿæ—¶åºåˆ†æ
æ„å»ºMonocle3æ‰€éœ€æ•°æ®
expression_matrixï¼šè¡Œæ˜¯geneï¼Œåˆ—æ˜¯cellçš„è¡¨è¾¾çŸ©é˜µ
cell_metadata:å¯¹åº”Seuratå¯¹è±¡çš„meta.dataä¿¡æ¯
gene_metadata:åŸºå› åç§°ä¿¡æ¯ï¼Œå¯ç”¨Gene symbol
```{r}
library(monocle3)
library(Seurat)
library(tidyverse)

expression_matrix=obj_cafs@assays$RNA$data
cell_metadata=data.frame(obj_cafs@meta.data)
gene_annotation=data.frame(expression_matrix[,1])
gene_annotation[,1]=row.names(gene_annotation)
colnames(gene_annotation)=c("gene_short_name")
##æ„å»ºMonocle3 cdså¯¹è±¡
cds = new_cell_data_set(expression_data = expression_matrix,
                        cell_metadata = cell_metadata,
                        gene_metadata = gene_annotation)

#é¢„å¤„ç†ï¼Œç›¸å½“äºSeuratæµç¨‹normalizeè¿‡ç¨‹
#countsæ•°æ®é€‰æ‹©norm_method=c("log")
#dataæ•°æ®é€‰æ‹©norm_method=c("none")
cds<-preprocess_cds(cds,num_dim=50,norm_method=c("none"))

#å»é™¤æ‰¹æ¬¡æ•ˆåº”,å¤šä¸ªæ ·æœ¬æ—¶å¯ä»¥é€šè¿‡æ­¤æ–¹å¼å»é™¤æ‰¹æ¬¡
cds<-align_cds(cds,alignment_group="orig.ident")

##é™ç»´ï¼Œé»˜è®¤æ˜¯"Umap"æ–¹å¼
cds<-reduce_dimension(cds,cores=5)

##èšç±»åˆ†ç¾¤ï¼Œåˆ†è¾¨ç‡è°ƒå°ï¼Œæ˜¯ä¸ºäº†è®©ç»†èƒæ˜¯ä¸€ç¾¤å¯ä»¥æ›´å¥½å±•ç¤º
cds<-cluster_cells(cds,resolution=0.0000001)

##æ‹Ÿæ—¶åº
cds<-learn_graph(cds)


##é€‰æ‹©ç‰¹å®šç»†èƒä½œä¸ºèµ·ç‚¹ï¼Œä»£ç æ¯”äº¤äº’å¼é¡µé¢æ–¹ä¾¿è®¸å¤šï¼Œä¸”ä¸ä¼šå‡ºç°é€‰ä¸­è‡ªå·±ä¸æƒ³è¦çš„ç»†èƒ
##è¿™é‡Œæˆ‘ä»¬å‡å®šä»¥Bç»†èƒä¸ºèµ·ç‚¹
myselect<-function(cds,select.classify,my_select){
cell_ids<-which(colData(cds)[,select.classify]==my_select)
closest_vertex<-
cds@principal_graph_aux[["UMAP"]]$pr_graph_cell_proj_closest_vertex
closest_vertex<-as.matrix(closest_vertex[colnames(cds),])
root_pr_nodes<-
igraph::V(principal_graph(cds)[["UMAP"]])$name[as.numeric(names
(which.max(table(closest_vertex[cell_ids,]))))]
root_pr_nodes}

cds<-order_cells(cds,root_pr_nodes=myselect(cds,select.classify='celltype',my_select="t_Tcm_LINC02446+"))




##ä½¿ç”¨Seuratçš„UMAPä¿¡æ¯ï¼Œè¿™æ ·å¯ä»¥ä¸Seuratå¯¹è±¡çš„ç»†èƒåˆ†å¸ƒä¿æŒä¸€è‡´
#cds.embed<-cds@int_colData$reducedDims$UMAP
#int.embed<-Embeddings(obj_mye,reduction="umap")
#int.embed<-int.embed[rownames(cds.embed),]
#cds@int_colData$reducedDims$UMAP<-int.embed

# å®‰è£… ggsci åŒ…ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
#install.packages("ggsci")

# åŠ è½½åŒ…
library(ggsci)
##ä¸åŒç»†èƒç±»å‹æ‹Ÿæ—¶åºæ•°å€¼
##æ‹Ÿæ—¶åºå€¼è¶Šé«˜è¡¨ç¤ºç»†èƒåˆ†åŒ–ç¨‹åº¦è¶Šé«˜ï¼Œè¿™é‡Œä»…ä¸ºæ¼”ç¤ºï¼Œå¹¶éçœŸå®åˆ†åŒ–æƒ…å†µ
p = plot_cells(cds,color_cells_by="pseudotime",
  show_trajectory_graph=T)+plot_cells(cds,
  color_cells_by="celltype",
  label_cell_groups=FALSE,
  label_leaves=FALSE,
  label_branch_points=FALSE,
  graph_label_size=1)+scale_color_manual(values=pal_jco("default",alpha=0.6)(13))

pdf(file = "plot/CAFs//æ‹Ÿæ—¶åºåˆ†æ.pdf",width = 10,height = 7)
p
dev.off

genes<-c('CD19','t',"SPP1")
genes_cds<-cds[rowData(cds)$gene_short_name%in%genes,]
p = plot_genes_in_pseudotime(genes_cds,color_cells_by="celltype",min_expr=0.5,cell_size=1.5)+scale_color_manual(values=pal_jco("default",alpha=0.6)(13))

pdf(file = "plot/Mye/Monocle3å·®å¼‚åˆ†ææ.pdf",width = 15,height = 10)
p
dev.off
```





